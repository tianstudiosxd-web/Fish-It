-- Fish Count - RemoteEvent GiveCoins Tester
-- Untuk testing keamanan game Anda
-- FIXED VERSION

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer

-- Tunggu player fully loaded
repeat task.wait() until player

-- Hapus GUI lama jika ada (mencegah duplikat)
local function destroyOldGui()
    pcall(function()
        if game:GetService("CoreGui"):FindFirstChild("GiveCoinsTester") then
            game:GetService("CoreGui"):FindFirstChild("GiveCoinsTester"):Destroy()
        end
    end)
    pcall(function()
        if player.PlayerGui:FindFirstChild("GiveCoinsTester") then
            player.PlayerGui:FindFirstChild("GiveCoinsTester"):Destroy()
        end
    end)
    pcall(function()
        if gethui and gethui():FindFirstChild("GiveCoinsTester") then
            gethui():FindFirstChild("GiveCoinsTester"):Destroy()
        end
    end)
end

destroyOldGui()
task.wait(0.1)

-- Buat ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "GiveCoinsTester"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.DisplayOrder = 999

-- Coba parent ke berbagai lokasi (kompatibilitas executor)
local guiParented = false

-- Method 1: gethui() - untuk beberapa executor
pcall(function()
    if gethui then
        ScreenGui.Parent = gethui()
        guiParented = true
        print("[GiveCoins] GUI parented to gethui()")
    end
end)

-- Method 2: syn.protect_gui - untuk Synapse
if not guiParented then
    pcall(function()
        if syn and syn.protect_gui then
            syn.protect_gui(ScreenGui)
            ScreenGui.Parent = game:GetService("CoreGui")
            guiParented = true
            print("[GiveCoins] GUI parented to CoreGui (syn protected)")
        end
    end)
end

-- Method 3: CoreGui langsung
if not guiParented then
    pcall(function()
        ScreenGui.Parent = game:GetService("CoreGui")
        guiParented = true
        print("[GiveCoins] GUI parented to CoreGui")
    end)
end

-- Method 4: PlayerGui sebagai fallback
if not guiParented then
    pcall(function()
        ScreenGui.Parent = player:WaitForChild("PlayerGui", 5)
        guiParented = true
        print("[GiveCoins] GUI parented to PlayerGui")
    end)
end

if not guiParented then
    warn("[GiveCoins] GAGAL: Tidak bisa parent GUI!")
    return
end

print("[GiveCoins] GUI berhasil dibuat!")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 280, 0, 180)
MainFrame.Position = UDim2.new(0.5, -140, 0.5, -90)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = false
MainFrame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 10)
Corner.Parent = MainFrame

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(60, 60, 80)
Stroke.Thickness = 2
Stroke.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 35)
TitleBar.BackgroundColor3 = Color3.fromRGB(45, 120, 200)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local TitleFix = Instance.new("Frame")
TitleFix.Size = UDim2.new(1, 0, 0, 15)
TitleFix.Position = UDim2.new(0, 0, 1, -15)
TitleFix.BackgroundColor3 = Color3.fromRGB(45, 120, 200)
TitleFix.BorderSizePixel = 0
TitleFix.Parent = TitleBar

-- Title Text
local TitleText = Instance.new("TextLabel")
TitleText.Name = "Title"
TitleText.Size = UDim2.new(1, -40, 1, 0)
TitleText.Position = UDim2.new(0, 10, 0, 0)
TitleText.BackgroundTransparency = 1
TitleText.Text = "Fish Count - Coins Tester"
TitleText.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleText.TextSize = 14
TitleText.Font = Enum.Font.GothamBold
TitleText.TextXAlignment = Enum.TextXAlignment.Left
TitleText.Parent = TitleBar

-- Close Button
local CloseBtn = Instance.new("TextButton")
CloseBtn.Name = "CloseBtn"
CloseBtn.Size = UDim2.new(0, 25, 0, 25)
CloseBtn.Position = UDim2.new(1, -30, 0, 5)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 14
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.AutoButtonColor = false
CloseBtn.Parent = TitleBar

local CloseBtnCorner = Instance.new("UICorner")
CloseBtnCorner.CornerRadius = UDim.new(0, 5)
CloseBtnCorner.Parent = CloseBtn

-- Content Frame
local Content = Instance.new("Frame")
Content.Name = "Content"
Content.Size = UDim2.new(1, -20, 1, -55)
Content.Position = UDim2.new(0, 10, 0, 45)
Content.BackgroundTransparency = 1
Content.Parent = MainFrame

-- Label
local Label = Instance.new("TextLabel")
Label.Size = UDim2.new(1, 0, 0, 20)
Label.BackgroundTransparency = 1
Label.Text = "Masukkan Jumlah Coins:"
Label.TextColor3 = Color3.fromRGB(200, 200, 200)
Label.TextSize = 13
Label.Font = Enum.Font.Gotham
Label.TextXAlignment = Enum.TextXAlignment.Left
Label.Parent = Content

-- TextBox untuk input jumlah
local AmountBox = Instance.new("TextBox")
AmountBox.Name = "AmountBox"
AmountBox.Size = UDim2.new(1, 0, 0, 35)
AmountBox.Position = UDim2.new(0, 0, 0, 25)
AmountBox.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
AmountBox.Text = ""
AmountBox.PlaceholderText = "Contoh: 1000"
AmountBox.TextColor3 = Color3.fromRGB(255, 255, 255)
AmountBox.PlaceholderColor3 = Color3.fromRGB(120, 120, 120)
AmountBox.TextSize = 16
AmountBox.Font = Enum.Font.Gotham
AmountBox.ClearTextOnFocus = false
AmountBox.Parent = Content

local AmountBoxCorner = Instance.new("UICorner")
AmountBoxCorner.CornerRadius = UDim.new(0, 8)
AmountBoxCorner.Parent = AmountBox

local AmountBoxStroke = Instance.new("UIStroke")
AmountBoxStroke.Color = Color3.fromRGB(80, 80, 100)
AmountBoxStroke.Thickness = 1
AmountBoxStroke.Parent = AmountBox

-- Enter Button
local EnterBtn = Instance.new("TextButton")
EnterBtn.Name = "EnterBtn"
EnterBtn.Size = UDim2.new(1, 0, 0, 35)
EnterBtn.Position = UDim2.new(0, 0, 0, 70)
EnterBtn.BackgroundColor3 = Color3.fromRGB(50, 180, 80)
EnterBtn.Text = "GIVE COINS"
EnterBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
EnterBtn.TextSize = 15
EnterBtn.Font = Enum.Font.GothamBold
EnterBtn.AutoButtonColor = false
EnterBtn.Parent = Content

local EnterBtnCorner = Instance.new("UICorner")
EnterBtnCorner.CornerRadius = UDim.new(0, 8)
EnterBtnCorner.Parent = EnterBtn

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "Status"
StatusLabel.Size = UDim2.new(1, 0, 0, 20)
StatusLabel.Position = UDim2.new(0, 0, 0, 110)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "Status: Ready"
StatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusLabel.TextSize = 11
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Parent = Content

-- Fungsi untuk update status
local function updateStatus(text, color)
    StatusLabel.Text = "Status: " .. text
    StatusLabel.TextColor3 = color or Color3.fromRGB(150, 150, 150)
end

-- Fungsi untuk mencari RemoteEvent
local function findRemote()
    local remote = nil
    
    -- Cari di ReplicatedStorage
    pcall(function()
        remote = ReplicatedStorage:FindFirstChild("GiveCoins")
    end)
    if remote then return remote end
    
    -- Cari recursive di ReplicatedStorage
    pcall(function()
        for _, v in pairs(ReplicatedStorage:GetDescendants()) do
            if v:IsA("RemoteEvent") and v.Name == "GiveCoins" then
                remote = v
                break
            end
        end
    end)
    if remote then return remote end
    
    -- Cari di seluruh game
    pcall(function()
        for _, v in pairs(game:GetDescendants()) do
            if v:IsA("RemoteEvent") and v.Name == "GiveCoins" then
                remote = v
                break
            end
        end
    end)
    
    return remote
end

-- Fungsi utama untuk fire remote
local function fireGiveCoins()
    local amount = tonumber(AmountBox.Text)
    
    if not amount then
        updateStatus("Masukkan angka yang valid!", Color3.fromRGB(255, 100, 100))
        return
    end
    
    if amount <= 0 then
        updateStatus("Jumlah harus lebih dari 0!", Color3.fromRGB(255, 100, 100))
        return
    end
    
    local remote = findRemote()
    
    if not remote then
        updateStatus("Remote 'GiveCoins' tidak ditemukan!", Color3.fromRGB(255, 100, 100))
        print("[GiveCoins] ERROR: RemoteEvent tidak ditemukan!")
        return
    end
    
    updateStatus("Mengirim request...", Color3.fromRGB(255, 200, 100))
    
    -- Fire remote dengan berbagai format
    local success = false
    
    pcall(function()
        remote:FireServer(amount)
        success = true
    end)
    
    pcall(function()
        remote:FireServer("Coins", amount)
    end)
    
    pcall(function()
        remote:FireServer({Amount = amount})
    end)
    
    pcall(function()
        remote:FireServer(player, amount)
    end)
    
    if success then
        updateStatus("Terkirim! Amount: " .. tostring(amount), Color3.fromRGB(100, 255, 100))
    else
        updateStatus("Gagal mengirim!", Color3.fromRGB(255, 100, 100))
    end
    
    print("=====================================")
    print("[GiveCoins] Remote fired!")
    print("Path:", remote:GetFullName())
    print("Amount:", amount)
    print("=====================================")
end

-- Event Handlers
EnterBtn.MouseButton1Click:Connect(fireGiveCoins)

AmountBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        fireGiveCoins()
    end
end)

CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Hover effects
EnterBtn.MouseEnter:Connect(function()
    TweenService:Create(EnterBtn, TweenInfo.new(0.15), {
        BackgroundColor3 = Color3.fromRGB(60, 200, 90)
    }):Play()
end)

EnterBtn.MouseLeave:Connect(function()
    TweenService:Create(EnterBtn, TweenInfo.new(0.15), {
        BackgroundColor3 = Color3.fromRGB(50, 180, 80)
    }):Play()
end)

CloseBtn.MouseEnter:Connect(function()
    TweenService:Create(CloseBtn, TweenInfo.new(0.15), {
        BackgroundColor3 = Color3.fromRGB(230, 70, 70)
    }):Play()
end)

CloseBtn.MouseLeave:Connect(function()
    TweenService:Create(CloseBtn, TweenInfo.new(0.15), {
        BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    }):Play()
end)

-- Draggable System
local dragging = false
local dragStart = nil
local startPos = nil

TitleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

TitleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end
end)

-- Startup
print("=====================================")
print("Fish Count - GiveCoins Tester LOADED!")
print("GUI Status: Active")
print("=====================================")

updateStatus("Ready", Color3.fromRGB(100, 200, 255))
